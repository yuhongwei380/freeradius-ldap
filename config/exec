# /etc/freeradius/3.0/mods-available/exec

# 为预认证定义的特定实例
exec pre_auth_trigger {
    program = "/usr/local/bin/pre_auth_ldap_wrapper.sh"
    wait = yes

    # 【修正版】
    # 使用 %{} 语法来引用 RADIUS 属性和环境变量
    # %{User-Name}, %{User-Password}: 来自 RADIUS 请求
    # %{env:...}: 从 FreeRADIUS 进程的环境变量获取值 (这些值来自你的 .env 文件)
    environment_variables = "RAD_USERNAME=%{User-Name}, RAD_USER_PASSWORD=%{User-Password}, ldap_server=%{env:ldap_server}, ldap_basedn=%{env:ldap_basedn}"

    # 其他配置保持不变
    input_pairs = request
    shell_escape = yes
    timeout = 10
}

# 为 accounting 和 post-auth 部分定义的默认实例（即使为空）
exec {
    # 保持空块或添加基本配置
    wait = no
    program = "/bin/true"
}  
