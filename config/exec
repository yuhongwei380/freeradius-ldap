# /etc/freeradius/3.0/mods-available/exec
exec pre_auth_trigger {
    # 脚本路径
    program = "/usr/local/bin/pre_auth_ldap_wrapper.sh"

    # 等待脚本执行完成
    wait = yes

    # 将 RADIUS 属性映射为环境变量
    environment_variables = "RAD_USERNAME=%{User-Name}, RAD_USER_PASSWORD=%{User-Password}"

    # 【修正后的语法】传递 Docker 的环境变量
    # 无需括号和逗号，直接用引号和空格分隔
    pass_environment_variables = "ldap_server" "ldap_basedn"

    # 其他推荐配置
    input_pairs = request
    shell_escape = yes
    timeout = 10 
}

exec {
    # wait = yes/no
    # input_pairs = ...
    # program = ...
    # 如果您不打算在这两个阶段做任何特殊事情，可以保持这个块为空或注释掉具体的指令
    # 但这个 "exec { }" 块的存在告诉 FreeRADIUS 有一个名为 "exec" 的模块实例
    # 或者，如果您想让它什么都不做，可以明确写：
    # wait = no
    # input_pairs = none
    # shell_escape = no
    # program = "/bin/true" # 一个总是成功且什么都不做的程序
}
